{"version":3,"sources":["test/messages.integration.test.ts"],"names":[],"mappings":"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","file":"test/messages.integration.test.js","sourcesContent":["import * as assert from 'assert'\r\nimport {isArray} from 'util'\r\nimport {EsendexFake} from './esendexfake'\r\nimport Esendex = require('../lib/index')\r\n\r\ndescribe('Messages Integration', function () {\r\n\r\n  var esendexFake;\r\n  var esendex;\r\n\r\n  before(function (done) {\r\n    var fakePort = process.env.PORT || 3000;\r\n    esendexFake = new EsendexFake();\r\n\r\n    esendexFake.listen(fakePort, function () {\r\n      esendex = Esendex({\r\n        host: 'localhost',\r\n        port: fakePort,\r\n        https: false\r\n      });\r\n      done();\r\n    });\r\n  });\r\n\r\n  after(function () {\r\n    esendexFake.close();\r\n  });\r\n\r\n  describe('get latest sent messages', function () {\r\n\r\n    var messages;\r\n\r\n    before(function (done) {\r\n      var options = { count: 3 };\r\n\r\n      esendex.messages.get(options, function (err, messageheaders) {\r\n        if (err) return done(err);\r\n        messages = messageheaders;\r\n        done();\r\n      });\r\n    });\r\n\r\n    it('should return the count of returned sent messages', function () {\r\n      assert.ok(messages.count);\r\n    });\r\n\r\n    it('should return the total count of sent messages', function () {\r\n      assert.ok(messages.totalcount);\r\n    });\r\n\r\n    it('should return an array of messageheader', function () {\r\n      assert.ok(isArray(messages.messageheader));\r\n    });\r\n  });\r\n\r\n  describe('get single message', function () {\r\n\r\n    var message;\r\n\r\n    before(function (done) {\r\n      var options = { id: 'CDEB3533-1F76-46D7-A2A9-0DAF8290F7FC' };\r\n\r\n      esendex.messages.get(options, function (err, messageheader) {\r\n        if (err) return done(err);\r\n        message = messageheader;\r\n        done();\r\n      });\r\n    });\r\n\r\n    it('should return the expected messageheader', function () {\r\n      assert.strictEqual(message.id, 'CDEB3533-1F76-46D7-A2A9-0DAF8290F7FC');\r\n      assert.strictEqual(message.uri, 'http://api.esendex.com/v1.0/messageheaders/CDEB3533-1F76-46D7-A2A9-0DAF8290F7FC/');\r\n      assert.strictEqual(message.status, 'Delivered');\r\n      assert.strictEqual(message.laststatusat, '2010-01-01T12:00:05.000');\r\n      assert.strictEqual(message.submittedat, '2010-01-01T12:00:02.000');\r\n      assert.strictEqual(message.type, 'SMS');\r\n      assert.strictEqual(message.to.phonenumber, '447700900123');\r\n      assert.strictEqual(message.from.phonenumber, '447700900654');\r\n      assert.strictEqual(message.summary, 'Testing REST API');\r\n      assert.strictEqual(message.body.uri, 'http://api.esendex.com/v1.0/messageheaders/CDEB3533-1F76-46D7-A2A9-0DAF8290F7FC/body');\r\n      assert.strictEqual(message.direction, 'Outbound');      \r\n      assert.strictEqual(message.parts, '1');      \r\n      assert.strictEqual(message.username, 'user@example.com');      \r\n    });\r\n  });\r\n\r\n  describe('send a message', function () {\r\n\r\n    var response;\r\n    var loggedRequest;\r\n\r\n    before(function (done) {\r\n      var messages = {\r\n        accountreference: 'EX0123456',\r\n        message: [{\r\n          to: '447000000000',\r\n          body: 'Every message matters!'\r\n        }]\r\n      };\r\n\r\n      esendex.messages.send(messages, function (err, res) {\r\n        if (err) return done(err);\r\n        response = res;\r\n        loggedRequest = esendexFake.dispatcherRequests.length === 0 ? null :  esendexFake.dispatcherRequests[0];\r\n        done();\r\n      });\r\n    });\r\n\r\n    it('should return the batch ID of the sent message', function () {\r\n      assert.strictEqual(response.batchid, 'F8BF9867-FF81-49E4-ACC5-774DE793B776');\r\n    });\r\n\r\n    it('should return the messageheader ID and uri of the sent message', function () {\r\n      assert.strictEqual(response.messageheader[0].id, '1183C73D-2E62-4F60-B610-30F160BDFBD5');\r\n      assert.strictEqual(response.messageheader[0].uri, 'https://api.esendex.com/v1.0/messageheaders/1183C73D-2E62-4F60-B610-30F160BDFBD5');\r\n    });\r\n\r\n    it('should return an array of sent message headers', function () {\r\n      assert.ok(isArray(response.messageheader));\r\n    });\r\n\r\n    it('should return one sent message header', function () {\r\n      assert.strictEqual(response.messageheader.length, 1);\r\n    });\r\n  });\r\n\r\n  describe('send a unicode message', function () {\r\n\r\n    var response;\r\n    var loggedRequest;\r\n\r\n    before(function (done) {\r\n      var messages = {\r\n        accountreference: 'EX0123456',\r\n        characterset: 'Unicode',\r\n        message: [{\r\n          to: '447000000000',\r\n          body: 'Every üê≥ matters!'\r\n        }]\r\n      };\r\n\r\n      esendex.messages.send(messages, function (err, res) {\r\n        if (err) return done(err);\r\n        response = res;\r\n        loggedRequest = esendexFake.dispatcherRequests.length === 0 ? null :  esendexFake.dispatcherRequests[0];\r\n        done();\r\n      });\r\n    });\r\n\r\n    it('should return the batch ID of the sent message', function () {\r\n      assert.strictEqual(response.batchid, 'F8BF9867-FF81-49E4-ACC5-774DE793B776');\r\n    });\r\n\r\n    it('should return the messageheader ID and uri of the sent message', function () {\r\n      assert.strictEqual(response.messageheader[0].id, '1183C73D-2E62-4F60-B610-30F160BDFBD5');\r\n      assert.strictEqual(response.messageheader[0].uri, 'https://api.esendex.com/v1.0/messageheaders/1183C73D-2E62-4F60-B610-30F160BDFBD5');\r\n    });\r\n\r\n    it('should return an array of sent message headers', function () {\r\n      assert.ok(isArray(response.messageheader));\r\n    });\r\n\r\n    it('should return one sent message header', function () {\r\n      assert.strictEqual(response.messageheader.length, 1);\r\n    });\r\n  });\r\n\r\n});"],"sourceRoot":"../../src"}